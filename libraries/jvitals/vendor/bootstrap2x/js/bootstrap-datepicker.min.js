;(function($,window,document,undefined){'use strict';var Datepicker=function(element,options){this.element=$(element);this.current=this.element.val();this.defaultValue=options.defaultValue||this.element.data('default');this.isOpen=options.isOpen;this.language=options.language||this.element.data('language');this.format=this.parseFormat(options.format||this.element.data('format'));this.fullMonthDisplay=options.fullMonthDisplay;this.fullDayDisplay=options.fullDayDisplay;this.appendWidgetTo=options.appendWidgetTo;this.onClicked=options.onClicked||this.onClicked;this.updateFromElementVal();if(!this.current&&this.defaultValue){if(this.defaultValue&&this.defaultValue!=='0000-00-00'){this.element.val(this.formatDate(this.$date));this.current=this.element.val()}}this.buildCalendar();this._init()};Datepicker.prototype={constructor:Datepicker,_init:function(){var self=this;if(this.element.parent().hasClass('input-append')||this.element.parent().hasClass('input-prepend')){this.element.parent('.input-append, .input-prepend').find('.add-on').on({'click.datepicker':$.proxy(this.showWidget,this)})}this.element.on({'click.datepicker':$.proxy(this.showWidget,this)});this.$widget.on('click',$.proxy(this.widgetClick,this))},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,parseFormat:function(format){var separators=format.replace(this.validParts,'\0').split('\0'),parts=format.match(this.validParts);if(!separators||!separators.length||!parts||parts.length===0){throw new Error("Invalid date format.")}this.$format=format.replace(/m/gm,'M');return{separators:separators,parts:parts}},formatDate:function(date){var val={d:date.getUTCDate(),D:dates[this.language].daysShort[date.getUTCDay()],DD:dates[this.language].days[date.getUTCDay()],m:date.getUTCMonth()+1,M:dates[this.language].monthsShort[date.getUTCMonth()],MM:dates[this.language].months[date.getUTCMonth()],yy:date.getUTCFullYear().toString().substring(2),yyyy:date.getUTCFullYear()};val.dd=(val.d<10?'0':'')+val.d;val.mm=(val.m<10?'0':'')+val.m;var date=[],seps=$.extend([],this.format.separators);for(var i=0,cnt=this.format.parts.length;i<cnt;i++){if(seps.length)date.push(seps.shift());date.push(val[this.format.parts[i]])}return date.join('')},updateFromElementVal:function(){if(this.current){this.$date=Date.parseExact(this.current,this.$format).setTimezone('GMT')}else{var defaultValue=this.defaultValue;if(!defaultValue||defaultValue==='0000-00-00'){this.$date=Date.today().setTimezone('GMT')}else{this.$date=Date.parseExact(defaultValue,this.$format).setTimezone('GMT')}}this.currentYearView=this.$date.getFullYear();this.currentMonthView=this.$date.getMonth();this.currentDayView=this.$date.getUTCDate()},onClicked:function(ev,el,sel){},showWidget:function(){if(this.isOpen){return}this.current=this.element.val();this.updateFromElementVal();var self=this;$(document).on('mousedown.datepicker',function(e){if($(e.target).closest('.bootstrap-datepicker-widget').length===0){self.hideWidget()}});if(this.isOpen===false){this.$widget.addClass('open')}this.isOpen=true},hideWidget:function(){if(this.isOpen===false){return}this.$widget.removeClass('open');$(document).off('mousedown.datepicker');this.isOpen=false;this.rebuildCalendar()},widgetClick:function(e){e.stopPropagation();e.preventDefault();var target=$(e.target).closest('span, td, th');if(target.length==1){if($(target).hasClass('prev-month')||$(target).hasClass('prevMonth')){this.currentMonthView--;if(this.currentMonthView<0){this.currentYearView--;this.currentMonthView=11}this.rebuildCalendar()}else if($(target).hasClass('next-month')||$(target).hasClass('nextMonth')){this.currentMonthView++;if(this.currentMonthView>11){this.currentYearView++;this.currentMonthView=0}this.rebuildCalendar()}else if($(target).hasClass('day')&&!$(target).hasClass('today_link')&&!$(target).hasClass('clear_link')){var selected=new Date(this.currentYearView,this.currentMonthView,e.target.innerHTML).setTimezone('GMT');this.current=this.formatDate(selected);this.element.val(this.current);this.onClicked(e,this.element,selected);this.$date=Date.parseExact(this.current,this.$format).setTimezone('GMT');this.hideWidget()}else if($(target).hasClass('day')&&$(target).hasClass('today_link')){var selected=new Date.parse('today').setTimezone('GMT');this.current=this.formatDate(selected);this.element.val(this.current);this.onClicked(e,this.element,selected);this.$date=Date.parseExact(this.current,this.$format).setTimezone('GMT');this.hideWidget()}else if($(target).hasClass('day')&&$(target).hasClass('clear_link')){this.element.val('');this.onClicked(e,this.element,'');this.hideWidget()}}},isToday:function(day){var d1=Date.today();var d2=Date.parseExact(day+"/"+(this.currentMonthView+1)+"/"+this.currentYearView,["dd/mm/yyyy","d/mm/yyyy","dd/m/yyyy","d/m/yyyy"]);if(!d2){return false}return(Date.compare(d1,d2)===0)},buildCalendar:function(){var self=this;var calendarContainer=$('<div>',{"class":"bootstrap-datepicker-widget dropdown-menu"});this.currentMonth=this.buildCurrentMonth();var months=this.buildMonths();$(months).append(this.currentMonth);var calendar=$('<table>',{"class":"table-condensed"}).html($('<thead>').html($('<tr>',{"class":"weekdays"}).html(this.buildWeekdays())));var links=$('<table>',{"class":"table-condensed","width":"100%"}).html($('<thead>').html(this.buildLinks()));this.calendarBody=$('<tbody>');this.buildDays();$(calendar).append(this.calendarBody);$(calendarContainer).append(months).append(links).append(calendar);this.$widget=$(calendarContainer).prependTo(this.element.parents(this.appendWidgetTo))},rebuildCalendar:function(){this.calendarBody.empty();var content;if(this.fullMonthDisplay){content=dates[this.language].months[this.currentMonthView]}else{content=dates[this.language].monthsShort[this.currentMonthView]}content+=' '+this.currentYearView;this.currentMonth.text(content);this.buildDays()},buildLinks:function(){var linkHtml=document.createDocumentFragment();$(linkHtml).append($('<tr>',{"class":"today_link"}).append($('<td>',{"align":"left","width":"25%","class":"today_link day active"}).html('Today')).append($('<td>',{"align":"right","width":"25%"}).html('&nbsp;')).append($('<td>',{"align":"right","width":"25%"}).html('&nbsp;')).append($('<td>',{"align":"right","width":"25%","class":"clear_link day active"}).html('Clear')));return linkHtml},buildWeekdays:function(){var weekdays;if(this.fullDayDisplay){weekdays=dates[this.language].days}else{weekdays=dates[this.language].daysShort}var weekdayHtml=document.createDocumentFragment();$.each(weekdays,function(index,value){$(weekdayHtml).append($('<th>',{"class":"dow"}).text(value))});return weekdayHtml},buildCurrentMonth:function(){var content;if(this.fullMonthDisplay){content=dates[this.language].months[this.currentMonthView]}else{content=dates[this.language].monthsShort[this.currentMonthView]}content+=' '+this.currentYearView;return $('<span>',{"class":"current-month"}).text(content)},buildMonths:function(){var prevMonth=$('<span>',{"class":"prev-month"}).html($('<span>',{"class":"prevMonth"}).html('<i class="icon-arrow-left"></i>'));var nextMonth=$('<span>',{"class":"next-month"}).html($('<span>',{"class":"nextMonth"}).html('<i class="icon-arrow-right"></i>'));var months=$('<div>',{"class":"months"}).append(prevMonth).append(nextMonth);return months},buildDays:function(){var selected;if(this.current){selected=Date.parseExact(this.current,this.$format).setTimezone('GMT')}var firstOfMonth=new Date(this.currentYearView,this.currentMonthView,1).getDay(),numDays=Date.getDaysInMonth(this.currentYearView,this.currentMonthView),self=this,dayCount=0,i;var row=$('<tr>');for(i=1;i<=firstOfMonth;i++){row.append($('<td>').html('&nbsp;'));dayCount++}for(i=1;i<=numDays;i++){if(dayCount==7){this.calendarBody.append(row);row=$('<tr>');dayCount=0}var activeClass='';if(selected){var current=new Date(this.currentYearView,this.currentMonthView,i).setTimezone('GMT');if(Date.compare(current,selected)===0){activeClass='active'}}if(this.isToday(i)){row.append($('<td>',{"class":"today day "+activeClass}).text(i))}else{row.append($('<td>',{"class":"day "+activeClass}).text(i))}dayCount++}for(i=1;i<=(7-dayCount);i++){row.append($('<td>').html('&nbsp;'))}this.calendarBody.append(row)}};var old=$.fn.datepicker;$.fn.datepicker=function(option){var args=Array.apply(null,arguments);args.shift();return this.each(function(){var $this=$(this),data=$this.data('datepicker'),options=typeof option==='object'&&option;if(!data){$this.data('datepicker',(data=new Datepicker(this,$.extend({},$.fn.datepicker.defaults,options,$(this).data()))))}if(typeof option==='string'){data[option].apply(data,args)}})};$.fn.datepicker.defaults={current:null,defaultValue:null,isOpen:false,language:'en',format:'yyyy/mm/dd',fullMonthDisplay:true,fullDayDisplay:false,appendWidgetTo:'.bootstrap-datepicker'};$.fn.datepicker.Constructor=Datepicker;var dates=$.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today"}};$.fn.datepicker.noConflict=function(){$.fn.datepicker=old;return this}})(jQuery,window,document);